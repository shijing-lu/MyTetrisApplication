# 【俄罗斯方块游戏需求文档】 V2.0

## 引言

本文档详细描述了俄罗斯方块Android游戏应用的需求规格，包括版本修改记录、需求背景、整体设计、功能清单、需求描述、非功能性要求等内容。该应用基于Android平台开发，使用Kotlin语言和Jetpack Compose框架构建良好的用户界面。

---

## 修改记录

| 版本号 | 修改日期  | 改动点描述                                                                                                                                                                          | 修改人 |
| -------- | ----------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------- |
| V1.0   | 2025/7/15 | 初始版本，不具备可开发性。问题较多：<br />1.背景描述不清晰<br />2. 系统设计模块间耦合性太高<br />3. 图表绘制不规范<br />4. 大量代码片段<br />5. 自测用例覆盖不全面<br />6. 参考引用不规范 | 姚宇航 |
| V2.0   | 2025/7/19 | 修正需求背景，明确项目为学习成果检验项目，优化文档结构和内容 | 姚宇航 |

---

## 1. 需求背景

在经历了一段时间的Android应用开发学习，系统学习了Kotlin语言、Jetpack Compose等开发技术后，通过实际项目验证Android开发技能掌握程度。将学习的技术栈应用到完整的应用开发中，积累完整的项目开发经验，从需求分析到应用成型。

通过该项目来创建一个可展示的技术作品，体现学习成果:

1. **Kotlin语言：** 基本语法、对象、高阶函数、集合、扩展、委托等等
2. **Jetpack Compose：** 学习声明式UI开发，布局。    
3. **Android基础：**Android四大组件、Frament、数据存储
4. **Android架构：** MVVM架构模式

通过俄罗斯方块的实现，能巩固所学技术知识，培养解决问题的能力，实践良好的代码编写习惯，学习专业的需求文档和设计文档的编写。

---

## 2. 整体设计

### 2.1 系统架构

```
┌─────────────────────────────────────────────────────────────┐
│                    俄罗斯方块游戏系统架构                      │
├─────────────────────────────────────────────────────────────┤
│  表现层 (UI Layer)                                          │
│  ├── MainActivity.kt (主界面)                               │
│  ├── RecordScreen.kt (记录界面)                             │
│  └── GameView.kt (游戏视图)                                 │
├─────────────────────────────────────────────────────────────┤
│  业务逻辑层 (Business Logic Layer)                          │
│  ├── GameEngine.kt (游戏引擎)                               │
│  └── 游戏规则实现                                           │
├─────────────────────────────────────────────────────────────┤
│  数据层 (Data Layer)                                        │
│  ├── GameRecord.kt (记录数据模型)                           │
│  ├── SharedPreferences (本地存储)                           │
│  └── Gson (数据序列化)                                      │
└─────────────────────────────────────────────────────────────┘
```

### 2.2 技术栈选择

- **开发语言：** Kotlin
- **UI框架：** Jetpack Compose
- **设计系统：** Material Design 3
- **数据存储：** SharedPreferences + Gson
- **构建工具：** Gradle
- **最低支持版本：** Android API 21 (Android 5.0)

---

## 3. 功能清单

### 3.1 核心功能


| 功能模块 | 功能点         | 优先级 | 状态 |
| ---------- | ---------------- | -------- | ------ |
| 游戏核心 | 方块生成与下落 | P0     | ✅   |
| 游戏核心 | 方块移动控制   | P0     | ✅   |
| 游戏核心 | 方块旋转       | P0     | ✅   |
| 游戏核心 | 行消除判定     | P0     | ✅   |
| 游戏核心 | 游戏结束判定   | P0     | ✅   |
| 计分系统 | 得分计算       | P1     | ✅   |
| 计分系统 | 时间统计       | P1     | ✅   |
| 用户界面 | 游戏区域显示   | P0     | ✅   |
| 用户界面 | 虚拟控制按键   | P0     | ✅   |
| 用户界面 | 下一个方块预览 | P1     | ✅   |
| 记录管理 | 游戏记录保存   | P1     | ✅   |
| 记录管理 | 历史记录查看   | P1     | ✅   |
| 记录管理 | 记录排序功能   | P2     | ✅   |
| 记录管理 | 记录备注编辑   | P2     | ✅   |

### 3.2 功能优先级说明

- **P0 (核心功能)：** 游戏正常运行必需的功能
- **P1 (重要功能)：** 提升用户体验的重要功能
- **P2 (增强功能)：** 锦上添花的功能增强

---

## 4. 需求描述

### 4.1 用户操作流程说明

```
开始游戏
    ↓
进入主界面
    ↓
显示游戏区域和控制面板
    ↓
方块自动下落
    ↓
用户操作控制
    ├── 左移方块
    ├── 右移方块
    ├── 旋转方块
    └── 加速下落
    ↓
行消除判定
    ↓
更新得分和时间
    ↓
游戏结束判定
    ├── 继续游戏 → 返回方块下落
    └── 游戏结束 → 保存记录 → 显示结果
    ↓
选择操作
    ├── 重新开始 → 返回开始游戏
    ├── 查看记录 → 进入记录界面
    └── 退出游戏
```

### 4.2 功能详细描述

#### 4.2.1 游戏核心逻辑

**方块类型：**

- 支持7种经典俄罗斯方块形状：I、O、T、S、Z、J、L
- 每种方块具有不同的颜色标识

**游戏规则：**

1. 方块从顶部随机生成，自动下落
2. 用户可控制方块左右移动和旋转
3. 当一行被完全填满时，该行消除
4. 消除行数越多，得分越高
5. 当方块堆叠到顶部时，游戏结束

**得分规则：**

- 消除1行：100分
- 消除2行：200分
- 消除3行：300分
- 消除4行：400分

#### 4.2.2 用户界面设计

**主界面布局：**

```
┌─────────────────────────────────────────────────────────────┐
│                    游戏时长显示区域                           │
├─────────────────────┬───────────────────────────────────────┤
│                     │  得分显示区域                          │
│                     ├───────────────────────────────────────┤
│                     │  下一个方块预览区                      │
│    游戏主区域        │                                       │
│                     ├───────────────────────────────────────┤
│                     │  虚拟控制按键区                        │
│                     │  [←] [↑] [→]                          │
│                     │      [↓]                              │
│                     ├───────────────────────────────────────┤
│                     │  更多按钮                              │
└─────────────────────┴───────────────────────────────────────┘
```

**界面元素规格：**


| 元素     | 样式       | 逻辑           | 校验逻辑 | 备注                |
| ---------- | ------------ | ---------------- | ---------- | --------------------- |
| 游戏区域 | 20×10网格 | 实时更新       | 边界检查 | 白色背景，圆角设计  |
| 时长显示 | 卡片样式   | 每秒更新       | 无       | 显示格式：XX s      |
| 得分显示 | 卡片样式   | 实时更新       | 无       | 显示格式：得分: XXX |
| 预览区域 | 4×4网格   | 显示下一个方块 | 无       | 蓝色方块显示        |
| 控制按键 | 图标按钮   | 响应点击       | 无       | 方向箭头图标        |

#### 4.2.3 记录管理功能

**记录数据结构：**

```kotlin
data class GameRecord(
    val score: Int,        // 得分
    val time: Int,         // 游戏时长（秒）
    val date: String,      // 游戏日期
    val note: String = ""  // 备注信息
)
```

**记录功能特性：**

1. **自动保存：** 游戏结束时自动保存记录
2. **历史查看：** 支持查看所有历史游戏记录
3. **排序功能：** 支持按得分或日期排序
4. **备注编辑：** 支持为每条记录添加备注
5. **记录删除：** 支持删除不需要的记录
6. **数据导出：** 支持复制备注内容

---

## 5. 非功能性要求

### 5.1 性能要求


| 指标     | 要求    | 说明                     |
| ---------- | --------- | -------------------------- |
| 启动时间 | < 3秒   | 应用冷启动到主界面显示   |
| 响应时间 | < 100ms | 用户操作到界面响应       |
| 内存占用 | < 100MB | 正常运行时的内存使用     |
| 电池消耗 | 低      | 长时间游戏不影响电池续航 |

### 5.2 兼容性要求


| 平台     | 最低版本     | 目标版本      | 说明             |
| ---------- | -------------- | --------------- | ------------------ |
| Android  | 5.0 (API 21) | 14.0 (API 34) | 覆盖95%以上设备  |
| 屏幕尺寸 | 4.5寸        | 10寸          | 支持手机和平板   |
| 分辨率   | 480×800     | 4K            | 自适应不同分辨率 |

### 5.3 可用性要求


| 要求     | 说明                   |
| ---------- | ------------------------ |
| 易用性   | 界面简洁直观，操作简单 |
| 可访问性 | 支持无障碍功能         |
| 国际化   | 支持中英文界面         |
| 离线使用 | 无需网络连接即可使用   |

### 5.4 安全性要求


| 要求       | 说明               |
| ------------ | -------------------- |
| 数据安全   | 本地数据加密存储   |
| 权限最小化 | 仅申请必要权限     |
| 隐私保护   | 不收集用户个人信息 |

### 5.5 可维护性要求


| 要求       | 说明                   |
| ------------ | ------------------------ |
| 代码规范   | 遵循Kotlin编码规范     |
| 模块化设计 | 清晰的模块划分         |
| 文档完整   | 代码注释和文档齐全     |
| 测试覆盖   | 核心功能测试覆盖率>80% |

---

## 6. 技术实现细节

### 6.1 核心算法

**方块旋转算法：**

```kotlin
fun rotate() {
    val center = currentBlock.shape[1]
    val rotated = currentBlock.shape.map { (r, c) ->
        val dr = r - center.first
        val dc = c - center.second
        Pair(center.first - dc, center.second + dr)
    }
    val rotatedBlock = currentBlock.copy(shape = rotated)
    if (canPlace(rotatedBlock)) currentBlock = rotatedBlock
}
```

**行消除算法：**

```kotlin
fun clearLines(): Int {
    var lines = 0
    val newBoard = board.filter { row -> row.any { it == 0 } }.toMutableList()
    lines = numRows - newBoard.size
    repeat(lines) { newBoard.add(0, IntArray(numCols) { 0 }) }
    for (i in 0 until numRows) board[i] = newBoard[i]
    score += lines * 100
    return lines
}
```

### 6.2 数据存储方案

**SharedPreferences配置：**

- 文件名：`records`
- 访问模式：`Context.MODE_PRIVATE`
- 数据格式：JSON字符串

**数据序列化：**

```kotlin
// 保存记录
val gson = Gson()
val json = gson.toJson(recordList)
prefs.edit().putString("list", json).apply()

// 加载记录
val json = prefs.getString("list", null)
val type = object : TypeToken<List<GameRecord>>(){}.type
return Gson().fromJson(json, type)
```

### 6.3 UI组件设计

**Material Design 3主题：**

- 主色调：蓝色系
- 辅助色：绿色（得分）、橙色（时间）
- 背景色：浅灰色
- 卡片样式：圆角、阴影效果

**响应式布局：**

- 使用Jetpack Compose的权重布局
- 支持不同屏幕尺寸自适应
- 横竖屏切换支持

---

## 7. 测试策略

### 7.1 测试类型


| 测试类型 | 测试内容      | 测试方法         |
| ---------- | --------------- | ------------------ |
| 单元测试 | 游戏逻辑算法  | JUnit + Mockito  |
| 集成测试 | 模块间交互    | Espresso         |
| UI测试   | 界面交互      | Compose Testing  |
| 性能测试 | 内存和CPU使用 | Android Profiler |

### 7.2 测试用例

**核心功能测试：**

1. 方块生成和下落测试
2. 方块移动和旋转测试
3. 行消除和得分计算测试
4. 游戏结束判定测试

**用户界面测试：**

1. 界面元素显示测试
2. 用户交互响应测试
3. 不同屏幕尺寸适配测试
4. 横竖屏切换测试

**数据管理测试：**

1. 记录保存和加载测试
2. 记录排序功能测试
3. 记录编辑和删除测试
4. 数据持久化测试

---

## 8. 部署和发布

### 8.1 构建配置

**Gradle配置：**

```kotlin
android {
    compileSdk = 34
    defaultConfig {
        minSdk = 21
        targetSdk = 34
        versionCode = 1
        versionName = "1.0.0"
    }
}
```

**依赖管理：**

- Jetpack Compose: 1.5.0
- Material Design 3: 1.1.0
- Gson: 2.10.1

### 8.2 发布流程

1. **代码审查：** 确保代码质量和规范
2. **测试验证：** 完成所有测试用例
3. **构建打包：** 生成APK或AAB文件
4. **签名验证：** 使用正式签名证书
5. **发布上线：** 上传到Google Play Store

---

## 9. 附录

### 9.1 术语表


| 术语              | 定义                                       |
| ------------------- | -------------------------------------------- |
| 俄罗斯方块        | 经典的益智游戏，玩家控制下落的方块进行排列 |
| Jetpack Compose   | Android现代UI工具包                        |
| Material Design 3 | Google设计系统的最新版本                   |
| SharedPreferences | Android本地数据存储方案                    |
| Gson              | Google的JSON序列化库                       |

### 9.2 参考资料

1. [Android开发者文档](https://developer.android.com/)
2. [Jetpack Compose官方文档](https://developer.android.com/jetpack/compose)
3. [Material Design 3指南](https://m3.material.io/)
4. [Kotlin官方文档](https://kotlinlang.org/)

### 9.3 变更历史


| 日期       | 版本 | 变更内容     | 修改人       |
| ------------ | ------ | -------------- | -------------- |
| 2025/7/15 | V1.0 | 初始版本创建，不具备可开发性 | 姚宇航 |
| 2024/12/19 | V2.0 | 修正需求背景，明确项目为学习成果检验项目，优化文档结构和内容 | 姚宇航 |

---

**文档状态：** 已完成
**审核状态：** 待审核
**批准状态：** 待批准
